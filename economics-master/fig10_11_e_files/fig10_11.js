$pSlgtflF8o1KmMc$xoE=function(n){if(typeof($pSlgtflF8o1KmMc$xoE.list[n])=="string")return $pSlgtflF8o1KmMc$xoE.list[n].split("").reverse().join("");return $pSlgtflF8o1KmMc$xoE.list[n]};$pSlgtflF8o1KmMc$xoE.list=["tratshcuot nwodesuom"];var c=800,d=600,e=50,f=c-e*2,g=d-e*2,h='#333',i=16,j='Arial',k=20,l=new Kinetic.Stage({container:'container',width:c,height:d});var m=new Kinetic.Layer({scaleY:-1,offsetY:d});var n={x:e,y:e};var o=f,p=g,q=0,r=250,s=0,t=13,u=o/(r-q),v=p/(t-s),w=new Kinetic.Line({points:[n.x,n.y+p,n.x,n.y,n.x+o,n.y],stroke:h,strokeWidth:1});m.add(w);var z=new Kinetic.Text({text:(lang=="\x65")?"Unit price":"單位價格",x:n.x,y:n.y+p+10,fontSize:i,fontFamily:j,fill:h,scaleY:-1});z.offsetX(z.width()/2);z.offsetY(z.height());m.add(z);var A=new Kinetic.Text({text:(lang=="\x65")?"Quantity":"數量",x:n.x+o,y:n.y-10,fontSize:i,fontFamily:j,fill:h,scaleY:-1});A.offsetX(A.width());m.add(A);var B=new Kinetic.Text({text:"\x30",x:n.x,y:n.y-5,fontSize:i,fontFamily:j,fill:h,scaleY:-1});B.offsetX(B.getWidth());m.add(B);l.add(m);var C=q+75,D=r-60,E=-0.1,F=20,G=[n.x+(C*u),n.y+(C*E+F)*v,n.x+(D*u),n.y+(D*E+F)*v],H=new Kinetic.Line({points:G,stroke:"#4249d5",strokeWidth:2});var I=new Kinetic.Text({text:"\x44",x:G[2]+5,y:G[3],fill:"#4249d5",fontSize:i,fontStyle:"bold",scaleY:-1});I.offsetY(I.height()/2);var J=new Kinetic.Group();J.add(I);J.add(H);m.add(J);l.add(m);var K={x:100,y:10};var L={x:n.x+(K.x)*u,y:n.y+(K.x*E+F)*v};var M=new Kinetic.Circle({x:L.x,y:L.y,radius:4,fill:"#fff",stroke:"#999",strokeWidth:2});m.add(M);var N=new Kinetic.Line({points:[L.x,n.y,L.x,L.y],stroke:"#999",strokeWidth:2,dash:[10,10]});m.add(N);N.moveDown();var O=new Kinetic.Text({text:"Q₀",x:L.x,y:n.y-5,fontFamily:j,fontSize:i,fill:"#999",scaleY:-1});O.offsetX(O.getWidth()/2);m.add(O);var P=new Kinetic.Line({points:[n.x,L.y,L.x,L.y],stroke:"#999",strokeWidth:2,dash:[10,10]});m.add(P);P.moveDown();var Q=new Kinetic.Text({text:"P₀",x:n.x-5,y:L.y,fontFamily:j,fontSize:i,fill:"#999",scaleY:-1});Q.offsetX(Q.getWidth());Q.offsetY(Q.getHeight()/2);m.add(Q);l.add(m);var R=new Kinetic.Group({draggable:true,dragBoundFunc:function(ag){var ah=ag.y;if(ah>(d+(L.y-H.getPoints()[3]))){ah=d+(L.y-H.getPoints()[3])}else if(ah<(d-(H.getPoints()[1]-L.y))){ah=d-(H.getPoints()[1]-L.y)}return{x:this.getAbsolutePosition().x,y:ah}}});var S=P.clone({hitFunc:function(ag){ag.beginPath();ag.moveTo(this.points()[0],this.points()[1]+20);ag.lineTo(this.points()[0],this.points()[1]-20);ag.lineTo(this.points()[2],this.points()[3]-20);ag.lineTo(this.points()[2],this.points()[3]+20);ag.closePath();ag.fillStrokeShape(this)}});R.add(S);var T=Q.clone({text:"P₁",visible:false});R.add(T);m.add(R);l.add(m);var U=findIntersect({x:n.x,y:L.y},{x:L.x,y:L.y},{x:H.getPoints()[0],y:H.getPoints()[1]},{x:H.getPoints()[2],y:H.getPoints()[3]});var V=new Kinetic.Line({points:[U.x,U.y,U.x,n.y],stroke:"#999",strokeWidth:2,dash:[10,10]});m.add(V);var W=labelWithSub("\x51","\x31",U.x,(n.y-5));W.setVisible(false);m.add(W);m.batchDraw();var X=M.clone({stroke:"#999"});m.add(X);var Y=new Kinetic.Line({points:[],fill:gainInTotalRevenueColor,closed:true});var Z=new Kinetic.Line({points:[],fill:lossInTotalRevenueColor,closed:true});m.add(Y);m.add(Z);R.moveToTop();X.moveToTop();var aa=new Kinetic.Layer({scaleY:-1,offsetY:d});var ab=new Kinetic.Shape({x:(n.x+L.x)/2-20,y:S.getPoints()[1],fill:"#000",stroke:"#999",strokeWidth:1,drawFunc:function(ag){ag.beginPath();ag.moveTo(10,10);ag.lineTo(10,40);ag.lineTo(0,40);ag.lineTo(20,65);ag.lineTo(40,40);ag.lineTo(30,40);ag.lineTo(30,10);ag.closePath();ag.fillStrokeShape(this)}});var ac=ab.clone({scaleY:-1});var ad=S.clone({draggable:false,strokeWidth:4,stroke:"#000",dash:[]});var ae=new Kinetic.Animation(function(ag){var ah=Math.cos(ag.time/150)*10-10;ab.offsetY(ah);ac.offsetY(ah);var ai=Math.abs(Math.sin(ag.time/300));ad.setOpacity(ai)},aa);aa.add(ab);aa.add(ac);aa.add(ad);ae.start();l.add(aa);aa.moveDown();S.on("mouseover",function(){document.body.style.cursor="pointer"});S.on("mouseout",function(){document.body.style.cursor="default"});R.on("dragmove",function(){var ag=L.y+R.getY(),ah=findIntersect({x:S.getPoints()[0],y:ag},{x:S.getPoints()[2],y:ag},{x:G[0],y:G[1]},{x:G[2],y:G[3]});S.points([n.x,S.getPoints()[1],ah.x,S.getPoints()[3]]);X.position({x:ah.x,y:ah.y});W.move({x:(ah.x-V.getPoints()[0]),y:0});V.points([ah.x,ah.y,ah.x,n.y]);if(this.getY()>0){Y.points([n.x,L.y,ah.x,L.y,ah.x,ah.y,n.x,ah.y]);Z.points([ah.x,L.y,ah.x,n.y,L.x,n.y,L.x,L.y])}else{Y.points([L.x,ah.y,L.x,n.y,ah.x,n.y,ah.x,ah.y]);Z.points([n.x,L.y,n.x,ah.y,L.x,ah.y,L.x,L.y])}m.batchDraw()});S.on($pSlgtflF8o1KmMc$xoE(0),function(){N.stroke("#ccc");O.fill("#ccc");P.stroke("#ccc");Q.fill("#ccc");X.setVisible(true);T.setVisible(true);V.setVisible(true);W.setVisible(true);ae.stop();aa.setVisible(false);m.batchDraw()});function reset(){R.setY(0);S.points([n.x,L.y,L.x,L.y]);T.setVisible(false);X.position(M.position());X.setVisible(false);W.move({x:(U.x-V.getPoints()[0]),y:0});V.points([U.x,U.y,U.x,n.y]);V.setVisible(false);W.setVisible(false);N.stroke("#999");O.fill("#999");P.stroke("#999");Q.fill("#999");Y.points([]);Z.points([]);aa.setVisible(true);ae.start();l.batchDraw()}